{
  "permissions": {
    "allow": [
      "Bash(npm run prisma:generate:*)",
      "Bash(npm run migrate:dev:*)",
      "Bash(npm run typecheck:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(npx prisma validate:*)",
      "Bash(timeout 10 tail:*)",
      "Bash(npx prisma format:*)",
      "Bash(npx prisma migrate:*)",
      "Bash(npx prisma:*)",
      "Bash(timeout 5 tail:*)",
      "Bash(git restore:*)",
      "Bash(git tag -a v1.0.0 -m \"$(cat <<''EOF''\nRelease v1.0.0 - Commission System & Sales Analytics\n\nThis is the first stable release of the Banca Management Backend, marking the completion of the MVP with the addition of a comprehensive commission system.\n\nðŸŽ¯ Highlights\n\nâœ… Hierarchical commission system with JSON policies\nâœ… Immutable commission snapshots per bet (jugada)\nâœ… 6 new CRUD endpoints for policy management\nâœ… Extended sales analytics with commission metrics\nâœ… Complete documentation and migration guide\nâœ… Zero-downtime error handling\n\nðŸ“¦ New Features\n\nCommission System:\n- JSON-based commission policies (version 1)\n- Hierarchical resolution: USER â†’ VENTANA â†’ BANCA\n- First-match-wins rule evaluation\n- Support for loterÃ­a, betType, and multiplier range filters\n- Temporal validity (effectiveFrom/effectiveTo)\n- Auto-UUID generation for rules\n\nDatabase Schema:\n- commissionPolicyJson in Banca, Ventana, User (JSONB)\n- commissionPercent, commissionAmount, commissionOrigin, commissionRuleId in Jugada\n\nAPI Endpoints:\n- PUT/GET /api/v1/bancas/:id/commission-policy\n- PUT/GET /api/v1/ventanas/:id/commission-policy\n- PUT/GET /api/v1/users/:id/commission-policy\n\nSales Analytics Extensions:\n- /api/v1/ventas/summary with commissionTotal & netoDespuesComision\n- /api/v1/ventas/breakdown with commission metrics per dimension\n- /api/v1/ventas/timeseries with commission data\n\nðŸ“š Documentation\n\n- docs/COMMISSION_SYSTEM.md - Complete commission system guide\n- README.md - Updated with commission section\n- CHANGELOG.md - Detailed release notes\n\nðŸ”§ Migration\n\nRun: npx prisma migrate deploy && npx prisma generate\n\nâš ï¸ Breaking Changes\n\nNone - This is a backwards-compatible addition.\n\nðŸ™ Credits\n\nDeveloped by Mario QuirÃ³s Pizarro (@MQuirosP)\nWith assistance from Claude Code\nEOF\n)\")",
      "Bash(gh:*)",
      "Bash(git push:*)",
      "Bash(tree:*)",
      "Bash(npm run dev)",
      "Bash(node -e:*)",
      "Read(//c/Users/mquir/Proyectos/Bancas/**)",
      "Read(//c/Users/mquir/**)",
      "Bash(git log:*)",
      "Bash(test:*)",
      "Bash(awk:*)",
      "Bash(mkdir:*)",
      "Bash(git checkout:*)",
      "Bash(git merge feature/dashboard-v1-spec --no-ff -m \"$(cat <<''EOF''\nMerge branch ''feature/dashboard-v1-spec'' into master\n\nComplete implementation of Dashboard API v1.0.0\n\nThis merge brings the complete Dashboard API v1.0.0 implementation to master:\n\nDocumentation:\n- OpenAPI 3.1 specification (openapi-dashboard-v1.yaml)\n- README-DASHBOARD.md with comprehensive documentation\n- CHANGELOG-DASHBOARD.md with version history\n- Implementation status report\n\nNew Endpoints (4):\n- GET /timeseries - Time series data with day/hour intervals\n- GET /exposure - Financial exposure analysis\n- GET /vendedores - Seller rankings with pagination\n- GET /export - Export placeholder (CSV/XLSX/PDF)\n\nEnhanced Endpoints (4):\n- Main dashboard: Added timeSeries, exposure, previousPeriod, alerts\n- Ganancia: Added totalSales, margin calculations\n- Summary: Added winRate metric\n- All: Support for new filters (loteriaId, betType, interval)\n\nFeatures:\n- Alert system (HIGH_CXC, LOW_SALES, HIGH_EXPOSURE, OVERPAYMENT)\n- Previous period comparison\n- Performance metrics (queryExecutionTime, totalQueries)\n- RBAC enforcement (ADMIN/VENTANA/VENDEDOR)\n- Backward compatible (additive changes only)\n\nBug Fixes:\n- Fixed validator to accept all query parameters\n- Fixed column name (betType â†’ type) in Jugada queries\n- Added frontend compatibility (granularity alias)\n\nAll endpoints tested and working:\nâœ“ TypeScript compilation passes\nâœ“ 200 responses for all endpoints\nâœ“ RBAC properly enforced\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git branch:*)",
      "Bash(cat:*)"
    ],
    "deny": [],
    "ask": []
  }
}
